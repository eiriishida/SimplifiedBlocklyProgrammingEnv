<!DOCTYPE html>
<!--
„Åì„ÅÆ„Éè„Ç§„Éë„Éº„ÉÜ„Ç≠„Çπ„Éà„ÅØ Google Blockly „ÇíÂà©Áî®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
https://github.com/google/blockly
https://developers.google.com/blockly/

„Åì„ÅÆ„Éè„Ç§„Éë„Éº„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„É©„Ç§„Çª„É≥„Çπ„ÅØ‰ª•‰∏ã„ÅÆ„É©„Ç§„Çª„É≥„Çπ„Å´Ê∫ñ„Åò„Åæ„Åô„ÄÇ
Êú¨‰ΩìÈÉ®ÂàÜ
https://github.com/google/blockly/blob/master/LICENSE
„Çª„Éº„ÉñÔºÜ„É≠„Éº„ÉâÊ©üËÉΩ
https://qiita.com/terms

„Åì„ÅÆ„Éè„Ç§„Éë„Éº„ÉÜ„Ç≠„Çπ„Éà„ÅØ‰ª•‰∏ã„ÅÆ„Ç¶„Çß„Éñ„Éö„Éº„Ç∏Êé≤Ëºâ„ÅÆ„Ç≥„Éº„Éâ„ÇíÊîπÂ§â„Åó‰ΩúÊàê„Åï„Çå„Åæ„Åó„Åü„ÄÇ
Êú¨‰ΩìÈÉ®ÂàÜ
https://github.com/google/blockly/blob/master/demos/generator/index.html
https://github.com/google/blockly/blob/master/demos/headless/index.html
„ÉÑ„Éº„É´„Éú„ÉÉ„ÇØ„Çπ
https://github.com/google/blockly/blob/master/demos/code/index.html
„Çª„Éº„ÉñÔºÜ„É≠„Éº„ÉâÊ©üËÉΩ
https://qiita.com/kerupani129/items/99fd7a768538fcd33420

„Åì„ÅÆ„Éè„Ç§„Éë„Éº„ÉÜ„Ç≠„Çπ„Éà„ÅÆ‰ΩúÊàê„Å´„ÅÇ„Åü„Çä‰ª•‰∏ã„ÅÆÊñáÁåÆ„ÇíÂèÇËÄÉ„Å´„Åó„Åæ„Åó„Åü„ÄÇ
https://developers.google.com/blockly/reference/js/Blockly.Xml#.domToPrettyText
https://qiita.com/mvm43236/items/a5892f8e7a5037e37c1f
https://techacademy.jp/magazine/5488
https://techacademy.jp/magazine/34538
https://emojipedia.org/wastebasket/
https://www.w3.org/International/questions/qa-html-encoding-declarations.ja
https://www.nishishi.com/css/textarea-height-vh.html
-->

<!--„Ç¶„Çß„Éñ„Éö„Éº„Ç∏„ÅÆ„Éè„Ç§„Éë„Éº„ÉÜ„Ç≠„Çπ„ÉàË®òËø∞ÈÉ®-->
<html lang="ja">
<!--„Ç¶„Çß„Éñ„Éö„Éº„Ç∏„ÅÆ„Éò„ÉÉ„ÉÄ„Éº-->
<head>
  <!--„Ç¶„Çß„Éñ„Éö„Éº„Ç∏„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞-->
  <meta charset="utf-8">
  <!--„Ç¶„Çß„Éñ„Éö„Éº„Ç∏„ÅÆ„Éö„Éº„Ç∏„Çø„Ç§„Éà„É´-->
  <title>Blockly Programming Environment Simplified</title>
  <!--„Ç¶„Çß„Éñ„Éö„Éº„Ç∏Â§ñÈÉ®„Çπ„ÇØ„É™„Éó„Éà„ÅÆ„Ç§„É≥„ÇØ„É´„Éº„Éâ-->
  <script src="./scripts/blockly_compressed.js"></script>
  <script src="./scripts/blocks_compressed.js"></script>
  <script src="./scripts/python_compressed.js"></script>
  <script src="./scripts/javascript_compressed.js"></script>
  <script src="./msg/js/ja.js"></script>

  <!--„Ç¶„Çß„Éñ„Éö„Éº„Ç∏„ÅÆ„Çπ„Çø„Ç§„É´-->
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
    td {
      vertical-align: top;
    }
    textarea {
      width: 100%;
      height: 60.6vh;
    }
  </style>
</head>
<body>
  <!--Ë°®È°å-->
  <p align="center"><b><a href="https://developers.google.com/blockly/">Blockly</a> „Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞Áí∞Â¢É Á∞°ÊòìÁâà</b></p>

  <!--„Çª„Éº„ÉñÔºÜ„É≠„Éº„Éâ„Éú„Çø„É≥-->
  <p align="right">
    <button onclick="uploadXml()">üíæ„Éó„É≠„Ç∞„É©„É†„Çí„É≠„Éº„Éâ‚áß</button>
    <button onclick="downloadXml()">üíæ„Éó„É≠„Ç∞„É©„É†„Çí„Çª„Éº„Éñ‚á©</button>
    <button onclick="downloadHtml()">üåêWeb„Éö„Éº„Ç∏„Åß„Çª„Éº„Éñ‚á©</button>
  </p>

  <!--Ê©üËÉΩÂëº„Å≥Âá∫„Åó„Éú„Çø„É≥-->
  <p align="right">
    <button onclick="clearWorkspace()">üóëÔ∏èBlock„Çí„Åî„ÅøÁÆ±„Å∏</button>
    <button onclick="showJavaScript()"><b>JS</b> JavaScript„ÇíË°®Á§∫</button>
    <button onclick="showPython()">üêçPython„ÇíË°®Á§∫</button>
    <button onclick="showXml()">üîéXML„ÇΩ„Éº„Çπ„ÇíË°®Á§∫</button>
    <button onclick="runCode()">‚ñ∂„Éó„É≠„Ç∞„É©„É†„ÇíÂÆüË°å</button>
  </p>

  <table style="width: 100%">
    <tr>
      <!--Â∑¶„Éö„Ç§„É≥ÔºàBlocklyÔºâ-->
      <td style="width:61.5%">
  <!--Blockly„ÅÆ„ÉØ„Éº„ÇØ„Çπ„Éö„Éº„ÇπÊåøÂÖ•„Ç®„É™„Ç¢-->
  <div id="blocklyDiv" style="width: 100%; height: 61.5vh"></div>

  <!--Blockly„ÅÆ„ÉÑ„Éº„É´„Éú„ÉÉ„ÇØ„ÇπÔºàÊó•Êú¨Ë™ûÁâàÔºâ-->
  <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
    <category name="Ë´ñÁêÜ" colour="%{BKY_LOGIC_HUE}">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null"></block>
      <block type="logic_ternary"></block>
    </category>
    <category name="Áπ∞„ÇäËøî„Åó" colour="%{BKY_LOOPS_HUE}">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
        <value name="BY">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>
    <category name="ÊºîÁÆó" colour="%{BKY_MATH_HUE}">
      <block type="math_number">
        <field name="NUM">123</field>
      </block>
      <block type="math_arithmetic">
        <value name="A">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="B">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="math_single">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">9</field>
          </shadow>
        </value>
      </block>
      <block type="math_trig">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">45</field>
          </shadow>
        </value>
      </block>
      <block type="math_constant"></block>
      <block type="math_number_property">
        <value name="NUMBER_TO_CHECK">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="math_round">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">3.1</field>
          </shadow>
        </value>
      </block>
      <block type="math_on_list"></block>
      <block type="math_modulo">
        <value name="DIVIDEND">
          <shadow type="math_number">
            <field name="NUM">64</field>
          </shadow>
        </value>
        <value name="DIVISOR">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="math_constrain">
        <value name="VALUE">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="LOW">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="HIGH">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_int">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_float"></block>
      <block type="math_atan2">
        <value name="X">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="Y">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="„ÉÜ„Ç≠„Çπ„Éà" colour="%{BKY_TEXTS_HUE}">
      <block type="text"></block>
      <block type="text_join"></block>
      <block type="text_append">
        <value name="TEXT">
          <shadow type="text"></shadow>
        </value>
      </block>
      <block type="text_length">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_isEmpty">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT"></field>
          </shadow>
        </value>
      </block>
      <block type="text_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">„ÉÜ„Ç≠„Çπ„Éà</field>
          </block>
        </value>
        <value name="FIND">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_charAt">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">„ÉÜ„Ç≠„Çπ„Éà</field>
          </block>
        </value>
      </block>
      <block type="text_getSubstring">
        <value name="STRING">
          <block type="variables_get">
            <field name="VAR">„ÉÜ„Ç≠„Çπ„Éà</field>
          </block>
        </value>
      </block>
      <block type="text_changeCase">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_trim">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_print">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_prompt_ext">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="„É™„Çπ„Éà" colour="%{BKY_LISTS_HUE}">
      <block type="lists_create_with">
        <mutation items="0"></mutation>
      </block>
      <block type="lists_create_with"></block>
      <block type="lists_repeat">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">5</field>
          </shadow>
        </value>
      </block>
      <block type="lists_length"></block>
      <block type="lists_isEmpty"></block>
      <block type="lists_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">„É™„Çπ„Éà</field>
          </block>
        </value>
      </block>
      <block type="lists_getIndex">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">„É™„Çπ„Éà</field>
          </block>
        </value>
      </block>
      <block type="lists_setIndex">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">„É™„Çπ„Éà</field>
          </block>
        </value>
      </block>
      <block type="lists_getSublist">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">„É™„Çπ„Éà</field>
          </block>
        </value>
      </block>
      <block type="lists_split">
        <value name="DELIM">
          <shadow type="text">
            <field name="TEXT">,</field>
          </shadow>
        </value>
      </block>
      <block type="lists_sort"></block>
    </category>
    <category name="Ëâ≤" colour="%{BKY_COLOUR_HUE}">
      <block type="colour_picker"></block>
      <block type="colour_random"></block>
      <block type="colour_rgb">
        <value name="RED">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
        <value name="GREEN">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="BLUE">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="colour_blend">
        <value name="COLOUR1">
          <shadow type="colour_picker">
            <field name="COLOUR">#ff0000</field>
          </shadow>
        </value>
        <value name="COLOUR2">
          <shadow type="colour_picker">
            <field name="COLOUR">#3333ff</field>
          </shadow>
        </value>
        <value name="RATIO">
          <shadow type="math_number">
            <field name="NUM">0.5</field>
          </shadow>
        </value>
      </block>
    </category>
    <sep></sep>
    <category name="Â§âÊï∞" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
    <category name="Èñ¢Êï∞" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE"></category>
  </xml>

  <!--Blockly„ÅÆ„Çµ„É≥„Éó„É´„Ç≥„Éº„ÉâÔºàÈäÄÊ≤≥„Éí„ÉÉ„ÉÅ„Éè„Ç§„ÇØ„Ç¨„Ç§„ÉâÂèÇÁÖßÔºâ-->
  <xml xmlns="https://developers.google.com/blockly/xml" id="startBlocks" style="display: none">
    <block type="controls_if" inline="false" x="20" y="20">
      <mutation else="1"></mutation>
      <value name="IF0">
        <block type="logic_compare" inline="true">
          <field name="OP">EQ</field>
          <value name="A">
            <block type="math_arithmetic" inline="true">
              <field name="OP">MULTIPLY</field>
              <value name="A">
                <block type="math_number">
                  <field name="NUM">6</field>
                </block>
              </value>
              <value name="B">
                <block type="math_number">
                  <field name="NUM">7</field>
                </block>
              </value>
            </block>
          </value>
          <value name="B">
            <block type="math_number">
              <field name="NUM">42</field>
            </block>
          </value>
        </block>
      </value>
      <statement name="DO0">
        <block type="text_print" inline="false">
          <value name="TEXT">
            <block type="text">
              <field name="TEXT">Don't panic</field>
            </block>
          </value>
        </block>
      </statement>
      <statement name="ELSE">
        <block type="text_print" inline="false">
          <value name="TEXT">
            <block type="text">
              <field name="TEXT">Panic</field>
            </block>
          </value>
        </block>
      </statement>
    </block>
  </xml>
      </td>
      <!--Âè≥„Éö„Ç§„É≥Ôºà„Ç≥„Éº„ÉâÂá∫ÂäõÈÉ®Ôºâ-->
      <td style="width:38.5%">
        <textarea id="code_output" readonly></textarea>
      </td>
    </tr>
  </table>

  <script>
    // „Ç¶„Çß„Éñ„Éö„Éº„Ç∏„ÅÆJavaScriptË®òËø∞ÈÉ®
    var demoWorkspace = new Blockly.Workspace();
    var demoWorkspace = Blockly.inject('blocklyDiv',
        {media: './media/', toolbox: document.getElementById('toolbox')});
    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),
                               demoWorkspace);
    
    function showJavaScript() {
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      document.getElementById('code_output').value = code;
    }
    
    function showPython() {
      var code = Blockly.Python.workspaceToCode(demoWorkspace);
      document.getElementById('code_output').value = code;
    }
    
    function showXml() {
      var xml = Blockly.Xml.workspaceToDom(demoWorkspace);
      var code = Blockly.Xml.domToPrettyText(xml);
      document.getElementById('code_output').value = code;
    }
    
    function clearWorkspace() {
      // „ÉØ„Éº„ÇØ„Çπ„Éö„Éº„ÇπÂàùÊúüÂåñÈñ¢Êï∞
      demoWorkspace.clear();
    }
    
    function uploadXml() {
      // XML„ÇΩ„Éº„ÇπÂèñ„ÇäËæº„ÅøÈñ¢Êï∞
      const showOpenFileDialog = () => {
        return new Promise(resolve => {
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.blockly';
          input.onchange = event => { resolve(event.target.files[0]); };
          input.click();
        });
      };
      
      const readAsText = file => {
        return new Promise(resolve => {
          const reader = new FileReader();
          reader.readAsText(file);
          reader.onload = () => { resolve(reader.result); };
        });
      };
      
      (async () => {
        const file = await showOpenFileDialog();
        const content = await readAsText(file);
        try {
          var xml = Blockly.Xml.textToDom(content);
        } catch (e) {
          alert(e);
          return;
        }
        demoWorkspace.clear();
        Blockly.Xml.domToWorkspace(xml, demoWorkspace);
        alert(content);
      })();
    }
    
    function downloadXml() {
      // XML„ÇΩ„Éº„ÇπÊõ∏„ÅçÂá∫„ÅóÈñ¢Êï∞
      try {
        var xml = Blockly.Xml.workspaceToDom(demoWorkspace);
      } catch (e) {
        alert(e);
        return;
      }
      var sourcexml = Blockly.Xml.domToPrettyText(xml);
      var sourcename = prompt('‰øùÂ≠ò„Åô„Çã„Éó„É≠„Ç∞„É©„É†„Å´ÂêçÂâç„Çí‰ªò„Åë„Å¶‰∏ã„Åï„ÅÑ„ÄÇ');
      while (!sourcename.length) {
        sourcename = prompt('ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
      }
      var sourceextension = '.blockly'
      const a = document.createElement('a');
      a.href = 'data:text/plain,' + encodeURIComponent(sourcexml);
      a.download = sourcename + sourceextension;
      a.style.display = 'none';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
    
    function downloadHtml() {
    // ÂÆüË°åÂèØËÉΩ„Å™Web„Éö„Éº„Ç∏„ÅÆÁîüÊàê„ÉªÂá∫ÂäõÈñ¢Êï∞
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      try {
        var pagescript = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      } catch (e) {
        alert(e);
        return;
      }
      var pagebegin = '\<\!DOCTYPE html\>\n\<html lang\=\"ja\"\>\n\<head\>\n\<meta charset\=\"utf-8\"\/\>\n\<\/head\>\n\<script\>\n\n';
      var pageend = '\n\<\/script\>\n\<\/html\>';
      var pagecode = pagebegin + pagescript + pageend;
      var sourcename = prompt('‰øùÂ≠ò„Åô„Çã„Éó„É≠„Ç∞„É©„É†„Å´ÂêçÂâç„Çí‰ªò„Åë„Å¶‰∏ã„Åï„ÅÑ„ÄÇ');
      while (!sourcename.length) {
        sourcename = prompt('ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
      }
      var sourceextension = '.html'
      const a = document.createElement('a');
      a.href = 'data:text/html,' + encodeURIComponent(pagecode);
      a.download = sourcename + sourceextension;
      a.style.display = 'none';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
    
    function runCode() {
      // JavaScript „ÅÆÁîüÊàê„ÉªÂÆüË°åÈñ¢Êï∞
      window.LoopTrap = 1000;
      Blockly.JavaScript.INFINITE_LOOP_TRAP =
          'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      try {
        eval(code);
      } catch (e) {
        alert(e);
      }
    }
  </script>

  <br>

  <!--Blockly„Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ„ÅÆ„Ç™„Éû„Éº„Ç∏„É•ÂÖÉ„ÅÆÁ¥π‰ªãË®ò‰∫ã„Å∏„ÅÆ„É™„É≥„ÇØ-->
  <a href="https://ja.wikipedia.org/wiki/%E7%94%9F%E5%91%BD%E3%80%81%E5%AE%87%E5%AE%99%E3%80%81%E3%81%9D%E3%81%97%E3%81%A6%E4%B8%87%E7%89%A9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E7%A9%B6%E6%A5%B5%E3%81%AE%E7%96%91%E5%95%8F%E3%81%AE%E7%AD%94%E3%81%88">ÁîüÂëΩ„ÄÅÂÆáÂÆô„ÄÅ„Åù„Åó„Å¶‰∏áÁâ©„Å´„Å§„ÅÑ„Å¶„ÅÆÁ©∂Ê•µ„ÅÆÁñëÂïè„ÅÆÁ≠î„ÅàÔºùÔºîÔºí</a>

</body>
</html>
